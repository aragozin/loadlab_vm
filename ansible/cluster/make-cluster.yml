---

- hosts: 127.0.0.1
  connection: local
  gather_facts: false
  vars_files:
    - ../labconfig.yml
  tasks:
    - name: Initialize node - loadbalancer @ 192.168.100.140
      import_tasks: init-container.yml
      vars:
        container_name: loadbalancer
        lab_ip: 192.168.100.140      

    - name: "Initialize node - {{container_name}} @ {{lab_ip}}"
      import_tasks: init-container.yml
      vars:
        container_name: web1
        lab_ip: 192.168.100.141

    - name: Initialize node - web2 @ 192.168.100.142
      import_tasks: init-container.yml
      vars:
        container_name: web2
        lab_ip: 192.168.100.142

    - name: Initialize node - database @ 192.168.100.143
      import_tasks: init-container.yml
      vars:
        container_name: database
        lab_ip: 192.168.100.143

    - name: Initialize node - metrics @ 192.168.100.144
      import_tasks: init-container.yml
      vars:
        container_name: metrics
        lab_ip: 192.168.100.144


    - name: Initialize node - front @ 192.168.100.145
      import_tasks: init-container.yml
      vars:
        container_name: front
        lab_ip: 192.168.100.145

    - name: Patch hosts files
      import_tasks: patch-hosts.yml
      apply:
        become: yes
      vars:
        container_name: masterhost

    - name: Configure SSH on host
      import_tasks:
        file: setup-ssh-keys.yml
      vars:
        container_name: masterhost